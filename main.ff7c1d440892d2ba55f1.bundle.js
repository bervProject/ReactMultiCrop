(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{313:function(module,exports,__webpack_require__){__webpack_require__(314),__webpack_require__(466),__webpack_require__(467),module.exports=__webpack_require__(657)},380:function(module,exports){},467:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(249)},657:function(module,exports,__webpack_require__){"use strict";(function(module){(0,__webpack_require__(249).configure)([__webpack_require__(658)],module,!1)}).call(this,__webpack_require__(125)(module))},658:function(module,exports,__webpack_require__){var map={"./ReactMultiCrop/ReactMultiCrop.stories.tsx":670};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=658},663:function(module,exports){},664:function(module,exports){},665:function(module,exports){},670:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Canvas",(function(){return ReactMultiCrop_stories_Canvas}));var react=__webpack_require__(0),react_default=__webpack_require__.n(react),objectWithoutProperties=(__webpack_require__(39),__webpack_require__(185),__webpack_require__(42),__webpack_require__(62),__webpack_require__(40),__webpack_require__(310)),classCallCheck=__webpack_require__(303),createClass=__webpack_require__(304),assertThisInitialized=__webpack_require__(64),inherits=__webpack_require__(311),createSuper=__webpack_require__(309),fabric=__webpack_require__(65),Grid=__webpack_require__(686),Button=__webpack_require__(687),ReactMultiCrop_ReactMultiCrop=function(_Component){Object(inherits.a)(ReactMultiCrop,_Component);var _super=Object(createSuper.a)(ReactMultiCrop);function ReactMultiCrop(props){var _this;return Object(classCallCheck.a)(this,ReactMultiCrop),(_this=_super.call(this,props)).state={canvas:null,initial:!0},_this.handleKeyPress=_this.handleKeyPress.bind(Object(assertThisInitialized.a)(_this)),_this.handleNewShape=_this.handleNewShape.bind(Object(assertThisInitialized.a)(_this)),_this.handleDeleteShape=_this.handleDeleteShape.bind(Object(assertThisInitialized.a)(_this)),_this.handleMultiSelect=_this.handleMultiSelect.bind(Object(assertThisInitialized.a)(_this)),_this.handleDiscardActiveObject=_this.handleDiscardActiveObject.bind(Object(assertThisInitialized.a)(_this)),_this}return Object(createClass.a)(ReactMultiCrop,[{key:"componentDidMount",value:function componentDidMount(){this.initialCanvas()}},{key:"componentDidUpdate",value:function componentDidUpdate(){this.changeImage()}},{key:"changeImage",value:function changeImage(){var record=this.props.record,setImage=this.loadImage.bind(this);fabric.fabric.Image.fromURL(record.image,setImage)}},{key:"loadImage",value:function loadImage(img){var _this$state=this.state,initial=_this$state.initial,canvas=_this$state.canvas;canvas&&(canvas.setBackgroundImage(img,canvas.renderAll.bind(canvas),{scaleX:canvas.getWidth()/(img.width||1),scaleY:canvas.getHeight()/(img.height||1)}),initial&&this.setState({initial:!1},this.initialObjects.bind(this)))}},{key:"initialImage",value:function initialImage(){var record=this.props.record,loadImageNow=this.loadImage.bind(this);fabric.fabric.Image.fromURL(record.image,loadImageNow)}},{key:"initialObjects",value:function initialObjects(){var canvas=this.state.canvas;if(canvas){var record=this.props.record,setOutput=this.setOutput.bind(this),setStateOf=this.setState.bind(this),inputObject=record.clippings,createObject=this.createObject.bind(this);void 0!==inputObject&&inputObject.forEach((function(coord){var rect=createObject(canvas,coord);canvas.add(rect)})),canvas.renderAll(),setStateOf({canvas:canvas},setOutput)}}},{key:"initialCanvas",value:function initialCanvas(){var canvas=new fabric.fabric.Canvas(this.props.id);canvas.uniScaleTransform=!0;var doubleClickEvent=this.doubleClickEvent.bind(this),objectModifiedEvent=this.setOutput.bind(this);canvas.on("mouse:dblclick",doubleClickEvent),canvas.on("object:modified",objectModifiedEvent);var initialImg=this.initialImage.bind(this);this.setState({canvas:canvas},initialImg)}},{key:"handleNewShape",value:function handleNewShape(){var canvas=this.state.canvas;if(canvas){var coor={id:null,rect:{x1:0,y1:0,x2:.2,y2:.2}},rect=this.createObject(canvas,coor);rect.lockRotation=!0,canvas.add(rect),canvas.renderAll(),this.setState({canvas:canvas},this.setOutput)}}},{key:"doubleClickEvent",value:function doubleClickEvent(options){if(options.target){var canvas=this.state.canvas;if(!canvas)return;var left=options.target.left,top=options.target.top,width=options.target.width,height=options.target.height,attribute={};attribute.left=left+5,attribute.top=top+5,attribute.width=width*options.target.scaleX,attribute.height=height*options.target.scaleY;var rect=this.createObjectByAttribute(attribute);rect.lockRotation=!0,canvas.add(rect),canvas.renderAll(),this.setState({canvas:canvas},this.setOutput)}}},{key:"createObjectByAttribute",value:function createObjectByAttribute(attribute){var _this$props=this.props,color=_this$props.color,opacity=_this$props.opacity,strokeDashArray=_this$props.strokeDashArray,strokeColor=_this$props.strokeColor,strokeWidth=_this$props.strokeWidth;return new fabric.fabric.Rect({left:attribute.left,top:attribute.top,width:attribute.width,height:attribute.height,fill:color,opacity:opacity,data:null,strokeDashArray:strokeDashArray,stroke:strokeColor,strokeWidth:strokeWidth})}},{key:"shapetoStructureData",value:function shapetoStructureData(element){var canvas=this.state.canvas;if(canvas){var coord={};coord.id=element.data;var left=element.left||0,top=element.top||0,width=element.width||0,height=element.height||0,scaleX=element.scaleX||0,scaleY=element.scaleY||0,x1=left/canvas.getWidth(),y1=top/canvas.getHeight(),x2=(left+width*scaleX)/canvas.getWidth(),y2=(top+height*scaleY)/canvas.getHeight(),rectangle={x1:x1,y1:y1,x2:x2,y2:y2};if(coord.rect=JSON.stringify(rectangle),canvas.backgroundImage instanceof fabric.fabric.Image){var imgWidth=canvas.backgroundImage.width||0,imgHeight=canvas.backgroundImage.height||0,rectanglePx={x1:x1*imgWidth,y1:y1*imgHeight,x2:x2*imgWidth,y2:y2*imgHeight};coord.rectPx=JSON.stringify(rectanglePx)}return coord.deletedAt="-1",coord}}},{key:"handleDeleteShape",value:function handleDeleteShape(){var canvas=this.state.canvas;canvas&&(canvas.getActiveObjects().forEach((function(element){canvas.remove(element)})),this.setState({canvas:canvas},this.setOutput))}},{key:"setOutput",value:function setOutput(){var canvas=this.state.canvas;if(canvas){var shapeToStructureData=this.shapetoStructureData.bind(this),outputValue=[];canvas.getObjects().forEach((function(element){outputValue.push(shapeToStructureData(element))})),this.props.input.onChange(outputValue)}}},{key:"createObject",value:function createObject(canvas,coor){var rectangle,_this$props2=this.props,color=_this$props2.color,opacity=_this$props2.opacity,strokeDashArray=_this$props2.strokeDashArray,strokeColor=_this$props2.strokeColor,strokeWidth=_this$props2.strokeWidth;rectangle="string"==typeof coor.rect?JSON.parse(coor.rect):coor.rect;var left=canvas.getWidth()*rectangle.x1,top=canvas.getHeight()*rectangle.y1,width=canvas.getWidth()*rectangle.x2-left,height=canvas.getHeight()*rectangle.y2-top;return new fabric.fabric.Rect({left:left,top:top,width:width,height:height,fill:color,opacity:opacity,data:coor.id,strokeDashArray:strokeDashArray,stroke:strokeColor,strokeWidth:strokeWidth})}},{key:"handleMultiSelect",value:function handleMultiSelect(){var canvas=this.state.canvas;if(canvas){canvas.discardActiveObject();var sel=new fabric.fabric.ActiveSelection(canvas.getObjects(),{canvas:canvas});canvas.setActiveObject(sel),canvas.requestRenderAll()}}},{key:"handleDiscardActiveObject",value:function handleDiscardActiveObject(){var canvas=this.state.canvas;canvas&&(canvas.discardActiveObject(),canvas.requestRenderAll())}},{key:"handleKeyPress",value:function handleKeyPress(event){"Delete"===event.key&&this.handleDeleteShape()}},{key:"render",value:function render(){var _this$props3=this.props,_this$props3$input=_this$props3.input,value=_this$props3$input.value,name=_this$props3$input.name,otherProps=Object(objectWithoutProperties.a)(_this$props3,["input"]);return react_default.a.createElement("div",{"data-testid":"canvas-wrapper",id:"canvas-wrapper"},react_default.a.createElement("p",null,name),react_default.a.createElement(Grid.a,{container:!0,direction:"row",justify:"flex-start",alignItems:"flex-start",spacing:8},react_default.a.createElement(Grid.a,{item:!0,xs:!0,onKeyDown:this.handleKeyPress,tabIndex:0},react_default.a.createElement("canvas",Object.assign({width:"800",height:"800",style:{border:"1px solid #aaa"}},otherProps))),react_default.a.createElement(Grid.a,{container:!0,item:!0,xs:!0,direction:"column",justify:"flex-start",alignItems:"flex-start",spacing:8},react_default.a.createElement(Grid.a,{item:!0,xs:!0},react_default.a.createElement(Button.a,{variant:"contained",id:"addmore",color:"primary",onClick:this.handleNewShape}," ","Add More Shapes")),react_default.a.createElement(Grid.a,{item:!0,xs:!0},react_default.a.createElement(Button.a,{variant:"contained",id:"deleteselected",color:"primary",onClick:this.handleDeleteShape}," ","Delete Selected Object"," ")),react_default.a.createElement(Grid.a,{item:!0,xs:!0},react_default.a.createElement(Button.a,{variant:"contained",id:"multiselect",color:"primary",onClick:this.handleMultiSelect}," ","Select All"," ")),react_default.a.createElement(Grid.a,{item:!0,xs:!0},react_default.a.createElement(Button.a,{variant:"contained",id:"discard",color:"primary",onClick:this.handleDiscardActiveObject}," ","Discard Selection"))),react_default.a.createElement("input",{type:"hidden",value:value})))}}]),ReactMultiCrop}(react.Component);ReactMultiCrop_ReactMultiCrop.defaultProps={id:"canvas",color:"grey",opacity:.5,strokeColor:"yellow",strokeDashArray:[5,5],strokeWidth:5,record:[],input:{value:"",name:"",onChange:function onChange(){}}};try{ReactMultiCrop_ReactMultiCrop.displayName="ReactMultiCrop",ReactMultiCrop_ReactMultiCrop.__docgenInfo={description:"",displayName:"ReactMultiCrop",props:{id:{defaultValue:{value:"canvas"},description:"",name:"id",required:!1,type:{name:"string"}},color:{defaultValue:{value:"grey"},description:"",name:"color",required:!1,type:{name:"string"}},opacity:{defaultValue:{value:.5},description:"",name:"opacity",required:!1,type:{name:"number"}},strokeColor:{defaultValue:{value:"yellow"},description:"",name:"strokeColor",required:!1,type:{name:"string"}},strokeDashArray:{defaultValue:{value:"[5, 5]"},description:"",name:"strokeDashArray",required:!1,type:{name:"number[]"}},strokeWidth:{defaultValue:{value:5},description:"",name:"strokeWidth",required:!1,type:{name:"number"}},record:{defaultValue:{value:"[]"},description:"",name:"record",required:!1,type:{name:"any"}},input:{defaultValue:{value:'{\n      value: "",\n      name: "",\n      onChange: function () {},\n    }'},description:"",name:"input",required:!1,type:{name:"any"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/ReactMultiCrop/ReactMultiCrop.tsx#ReactMultiCrop"]={docgenInfo:ReactMultiCrop_ReactMultiCrop.__docgenInfo,name:"ReactMultiCrop",path:"src/ReactMultiCrop/ReactMultiCrop.tsx#ReactMultiCrop"})}catch(__react_docgen_typescript_loader_error){}__webpack_exports__.default={title:"ReactMultiCrop"};var ReactMultiCrop_stories_Canvas=function Canvas(){return react_default.a.createElement(ReactMultiCrop_ReactMultiCrop,{id:"canvas",input:{name:"canvas",value:"",onChange:function onChange(){}},record:[]})}}},[[313,1,2]]]);
//# sourceMappingURL=main.ff7c1d440892d2ba55f1.bundle.js.map